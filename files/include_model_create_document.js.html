<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>include\model\create_document.js - PencilBlue</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\..\img\pb_logo.png" title="PencilBlue"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdminNavigation.html">AdminNavigation</a></li>
            
                <li><a href="../classes/AdminSubnavService.html">AdminSubnavService</a></li>
            
                <li><a href="../classes/ArticleService.html">ArticleService</a></li>
            
                <li><a href="../classes/CacheEntityService.html">CacheEntityService</a></li>
            
                <li><a href="../classes/CacheFactory.html">CacheFactory</a></li>
            
                <li><a href="../classes/ClientJS.html">ClientJS</a></li>
            
                <li><a href="../classes/CommentService.html">CommentService</a></li>
            
                <li><a href="../classes/ContentService.html">ContentService</a></li>
            
                <li><a href="../classes/DAO.html">DAO</a></li>
            
                <li><a href="../classes/DBEntityService.html">DBEntityService</a></li>
            
                <li><a href="../classes/DBManager.html">DBManager</a></li>
            
                <li><a href="../classes/DocumentCreator.html">DocumentCreator</a></li>
            
                <li><a href="../classes/EmailService.html">EmailService</a></li>
            
                <li><a href="../classes/FSEntityService.html">FSEntityService</a></li>
            
                <li><a href="../classes/JSONFSEntityService.html">JSONFSEntityService</a></li>
            
                <li><a href="../classes/Localization.html">Localization</a></li>
            
                <li><a href="../classes/MediaLoader.html">MediaLoader</a></li>
            
                <li><a href="../classes/MediaService.html">MediaService</a></li>
            
                <li><a href="../classes/MemoryEntityService.html">MemoryEntityService</a></li>
            
                <li><a href="../classes/MongoSessionStore.html">MongoSessionStore</a></li>
            
                <li><a href="../classes/PBError.html">PBError</a></li>
            
                <li><a href="../classes/PluginService.html">PluginService</a></li>
            
                <li><a href="../classes/ReadOnlySimpleLayeredService.html">ReadOnlySimpleLayeredService</a></li>
            
                <li><a href="../classes/RedisSessionStore.html">RedisSessionStore</a></li>
            
                <li><a href="../classes/SecurityService.html">SecurityService</a></li>
            
                <li><a href="../classes/SessionHandler.html">SessionHandler</a></li>
            
                <li><a href="../classes/SimpleLayeredService.html">SimpleLayeredService</a></li>
            
                <li><a href="../classes/TemplateService.html">TemplateService</a></li>
            
                <li><a href="../classes/TopMenuService.html">TopMenuService</a></li>
            
                <li><a href="../classes/UrlService.html">UrlService</a></li>
            
                <li><a href="../classes/UserService.html">UserService</a></li>
            
                <li><a href="../classes/Util.html">Util</a></li>
            
                <li><a href="../classes/ValidationService.html">ValidationService</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Admin.html">Admin</a></li>
            
                <li><a href="../modules/Database.html">Database</a></li>
            
                <li><a href="../modules/Entities.html">Entities</a></li>
            
                <li><a href="../modules/ErrorSuccess.html">ErrorSuccess</a></li>
            
                <li><a href="../modules/Model.html">Model</a></li>
            
                <li><a href="../modules/Security.html">Security</a></li>
            
                <li><a href="../modules/Services.html">Services</a></li>
            
                <li><a href="../modules/Session.html">Session</a></li>
            
                <li><a href="../modules/Storage.html">Storage</a></li>
            
                <li><a href="../modules/Theme.html">Theme</a></li>
            
                <li><a href="../modules/Validation.html">Validation</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: include\model\create_document.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
    Copyright (C) 2014  PencilBlue, LLC

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
*/

/**
 * Creates structures for persistence and cleans various fields.
 *
 * @module Model
 * @class DocumentCreator
 * @constructor
 * @main Model
 */
function DocumentCreator(){}

/**
 * Creates a document object ready to be injected into the database
 *
 * @method create
 * @param  {String} object_type        The type of object to create
 * @param  {Object} post               Key value pair object to prepare
 * @param  {Array}  [csvItems]         Keys whose values are to be split from CSVs into arrays
 * @param  {Array}  [nullIfEmptyItems] Keys whose values are to be null if empty
 * @return {Object}                    The database ready document object
 */
DocumentCreator.create = function(object_type, post, csvItems, nullIfEmptyItems) {

	if(typeof csvItems !== &#x27;undefined&#x27;) {
		DocumentCreator.csvItemsToArrays(post, csvItems);
    }
    if(typeof nullIfEmptyItems !== &#x27;undefined&#x27;) {
    	DocumentCreator.emptyItemsToNull(post, nullIfEmptyItems);
    }

    DocumentCreator.passwordHash(post);
    DocumentCreator.emailFormatting(post);
    DocumentCreator.usernameFormatting(post);
    DocumentCreator.accessFormatting(post);
    post[&#x27;object_type&#x27;] = object_type;
    return post;
};

/**
 * Updates a document object with new properties
 *
 * @method update
 * @param  {Object} post               Key value pairs to update with
 * @param  {Object} existingObject     Object to update
 * @param  {Array}  [csvItems]         Keys whose values are to be split from CSVs into arrays
 * @param  {Array}  [nullIfEmptyItems] Keys whose values are to be null if empty
 * @return {Object}                    The database ready document object
 */
DocumentCreator.update = function(post, existingObject, csvItems, nullIfEmptyItems) {
	var newDoc = DocumentCreator.create(existingObject.object_type, post, csvItems, nullIfEmptyItems);
	pb.utils.merge(newDoc, existingObject);
};

/**
 * Hashes all password fields
 *
 * @method passwordHash
 * @param {Object} post Key value pair object
 */
DocumentCreator.passwordHash = function(post){
    for(var key in post) {
        if(key.indexOf(&#x27;password&#x27;) &gt; -1)
        {
            post[key] = pb.security.encrypt(post[key]);
        }
    }

    if(post[&#x27;confirm_password&#x27;]) {
        delete post[&#x27;confirm_password&#x27;];
    }
};

/**
 * Formats email fields
 *
 * @method emailFormatting
 * @param {Object} post Key value pair object
 */
DocumentCreator.emailFormatting = function(post){
	if(post[&#x27;email&#x27;]) {
        post[&#x27;email&#x27;] = post[&#x27;email&#x27;].toLowerCase();
    }
};

/**
 * Formats usernames
 *
 * @method usernameFormatting
 * @param {Object} post Key value pair object
 */
DocumentCreator.usernameFormatting = function(post){
	if(post[&#x27;username&#x27;]) {
        post[&#x27;username&#x27;] = post[&#x27;username&#x27;].toLowerCase();
    }
};

/**
 * Formats access levels
 *
 * @method accessFormatting
 * @param {Object} post Key value pair object
 */
DocumentCreator.accessFormatting = function(post){
	if(post[&#x27;admin&#x27;]) {
        post[&#x27;admin&#x27;] = parseInt(post[&#x27;admin&#x27;]);
    }
};

/**
 * Formats string items to integers
 *
 * @method formatIntegerItems
 * @param {Object} post         Key value pair object
 * @param {Array}  integerItems Keys whose values should be formatted as integers
 */
DocumentCreator.formatIntegerItems = function(post, integerItems) {
    for (var i = 0; i &lt; integerItems.length; i++) {
        if (typeof post[integerItems[i]] !== &#x27;undefined&#x27;) {
            post[integerItems[i]] = parseInt(post[integerItems[i]]);
        }
    }

    return post;
};

/**
 * Formats empty items to null values
 *
 * @method emptyItemsToNull
 * @param {Object} post             Key value pair object
 * @param {Array}  nullIfEmptyItems Keys whose values should be null if empty
 */
DocumentCreator.emptyItemsToNull = function(post, nullIfEmptyItems) {
    if(!nullIfEmptyItems) {
        return;
    }

    for (var i = 0; i &lt; nullIfEmptyItems.length; i++) {
        if (post[nullIfEmptyItems[i]]) {
            if(post[nullIfEmptyItems[i]].length == 0) {
                post[nullIfEmptyItems[i]] = null;
            }
        }
        else {
            post[nullIfEmptyItems[i]] = null;
        }
    }
};

/**
 * Splits CSV items into arrays
 *
 * @method csvItemsToArrays
 * @param {Object} post     Key value pair object
 * @param {Array}  csvItems Keys whose values should be arrays
 */
DocumentCreator.csvItemsToArrays = function(post, csvItems) {
    if (!csvItems) {
        return;
    }

    for (var i = 0; i &lt; csvItems.length; i++) {
        if(post[csvItems[i]]) {

        	var arrayItems = post[csvItems[i]].split(&#x27;,&#x27;);
            for (var j = 0; j &lt; arrayItems.length; j++) {
                arrayItems[j] = arrayItems[j].trim();
            }
            post[csvItems[i]] = arrayItems;
        }
        else {
            post[csvItems[i]] = [];
        }
    }
};

//exports
module.exports.DocumentCreator = DocumentCreator;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
