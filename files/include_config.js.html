<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>include\config.js - PencilBlue</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\..\img\pb_logo.png" title="PencilBlue"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdminNavigation.html">AdminNavigation</a></li>
            
                <li><a href="../classes/AdminSubnavService.html">AdminSubnavService</a></li>
            
                <li><a href="../classes/ArticleService.html">ArticleService</a></li>
            
                <li><a href="../classes/CacheEntityService.html">CacheEntityService</a></li>
            
                <li><a href="../classes/CacheFactory.html">CacheFactory</a></li>
            
                <li><a href="../classes/ClientJS.html">ClientJS</a></li>
            
                <li><a href="../classes/CommentService.html">CommentService</a></li>
            
                <li><a href="../classes/ContentService.html">ContentService</a></li>
            
                <li><a href="../classes/DAO.html">DAO</a></li>
            
                <li><a href="../classes/DBEntityService.html">DBEntityService</a></li>
            
                <li><a href="../classes/DBManager.html">DBManager</a></li>
            
                <li><a href="../classes/DocumentCreator.html">DocumentCreator</a></li>
            
                <li><a href="../classes/EmailService.html">EmailService</a></li>
            
                <li><a href="../classes/FSEntityService.html">FSEntityService</a></li>
            
                <li><a href="../classes/JSONFSEntityService.html">JSONFSEntityService</a></li>
            
                <li><a href="../classes/Localization.html">Localization</a></li>
            
                <li><a href="../classes/MediaLoader.html">MediaLoader</a></li>
            
                <li><a href="../classes/MediaService.html">MediaService</a></li>
            
                <li><a href="../classes/MemoryEntityService.html">MemoryEntityService</a></li>
            
                <li><a href="../classes/MongoSessionStore.html">MongoSessionStore</a></li>
            
                <li><a href="../classes/PBError.html">PBError</a></li>
            
                <li><a href="../classes/PluginService.html">PluginService</a></li>
            
                <li><a href="../classes/ReadOnlySimpleLayeredService.html">ReadOnlySimpleLayeredService</a></li>
            
                <li><a href="../classes/RedisSessionStore.html">RedisSessionStore</a></li>
            
                <li><a href="../classes/SecurityService.html">SecurityService</a></li>
            
                <li><a href="../classes/SessionHandler.html">SessionHandler</a></li>
            
                <li><a href="../classes/SimpleLayeredService.html">SimpleLayeredService</a></li>
            
                <li><a href="../classes/TemplateService.html">TemplateService</a></li>
            
                <li><a href="../classes/TopMenuService.html">TopMenuService</a></li>
            
                <li><a href="../classes/UrlService.html">UrlService</a></li>
            
                <li><a href="../classes/UserService.html">UserService</a></li>
            
                <li><a href="../classes/Util.html">Util</a></li>
            
                <li><a href="../classes/ValidationService.html">ValidationService</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Admin.html">Admin</a></li>
            
                <li><a href="../modules/Database.html">Database</a></li>
            
                <li><a href="../modules/Entities.html">Entities</a></li>
            
                <li><a href="../modules/ErrorSuccess.html">ErrorSuccess</a></li>
            
                <li><a href="../modules/Model.html">Model</a></li>
            
                <li><a href="../modules/Security.html">Security</a></li>
            
                <li><a href="../modules/Services.html">Services</a></li>
            
                <li><a href="../modules/Session.html">Session</a></li>
            
                <li><a href="../modules/Storage.html">Storage</a></li>
            
                <li><a href="../modules/Theme.html">Theme</a></li>
            
                <li><a href="../modules/Validation.html">Validation</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: include\config.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

var cluster = require(&#x27;cluster&#x27;);
var utils   = require(&#x27;./util.js&#x27;);

/**
 * Default configuration.  The settings here should be overriden by taking the
 * example file &quot;sample.config.json&quot; and modifying it to override the properties
 * shown below.  In order to properly override the default configuration do the
 * following:
 * 1) copy &quot;sample.config.json&quot; to &quot;/etc/pencilblue/config.json&quot;
 * 2) Override the properties as desired.
 * 3) Add any custom properties you wish to provide for your specific purposes.
 */

// Don&#x27;t change this setting
global.DOCUMENT_ROOT = __dirname.substr(0, __dirname.indexOf(path.sep+&#x27;include&#x27;));
global.EXTERNAL_ROOT = path.join(path.sep, &#x27;etc&#x27;, &#x27;pencilblue&#x27;);

global.LOG_LEVEL = &#x27;info&#x27;;
global.LOG_DIR   = path.join(DOCUMENT_ROOT, &#x27;log&#x27;);
global.LOG_FILE  = path.join(LOG_DIR, &#x27;pencilblue.log&#x27;);

var config = {
	siteName: &#x27;pencilblue&#x27;,
	siteRoot: &#x27;https://localhost:8080&#x27;,
	siteIP:   &#x27;localhost&#x27;,
	sitePort: 8080,
	docRoot:  DOCUMENT_ROOT,
	db: {
        type:&#x27;mongo&#x27;,
		servers: [
          &#x27;mongodb://127.0.0.1:27017/&#x27;
        ],
        name: &#x27;pencil_blue&#x27;,
        writeConern: 1,
        query_logging: false,
        authentication: {
            un: null,
            pw: null,
            options: {
                //authMechanism: &quot;MONGODB-CR&quot;|&quot;GSSAPI&quot;|&quot;PLAIN&quot;, //Defaults to MONGODB-CR
                //authdb: &quot;db name here&quot;, //Defaults to the db attempted to be connected to
                //authSource: &quot;db name here&quot;, //Defaults to value of authdb
            }
        }
	},
	cache: {
		fake: true,
		host: &quot;localhost&quot;,
		port: 6379,
        //auth_pass: &quot;password here&quot;
	},
	session: {
		storage: &quot;redis&quot;,
		timeout: 600000
	},
	log_level: LOG_LEVEL,
	locales: {
		supported: [
            {
            	locale: &#x27;en_us&#x27;,
            	file: path.join(DOCUMENT_ROOT, &#x27;public&#x27;, &#x27;localization&#x27;, &#x27;en-us.js&#x27;)
        	}
        ]
	},
	settings: {
		use_memory: true,
		use_cache: false
	},
	templates: {
		use_memory: true,
		use_cache: false
	},
	plugins: {
		caching: {
			use_memory: true,
			use_cache: false,
		}
	},
	registry: {
		enabled: true,
		update_interval: 10000,
		key: &#x27;server_registry&#x27;
	},
    cluster: {
        fatal_error_timeout: 2000,
        fatal_error_count: 5,
        workers: 1
    },
    server: {
        ssl: {
            enabled: false,
            handoff_port: 8080,
            use_x_forwarded: false,
            use_handoff_port_in_redirect: false,
            key: &quot;ssl/key.pem&quot;,
            cert: &quot;ssl/cert.crt&quot;,
            chain: &quot;ssl/chain.crt&quot;
        }
    }
};

var CONFIG_FILE_NAME    = &#x27;config.json&#x27;;
var OVERRIDE_FILE_PATHS = [
    path.join(DOCUMENT_ROOT, CONFIG_FILE_NAME),
    path.join(EXTERNAL_ROOT, CONFIG_FILE_NAME),
];

/**
 * Loads an external configuration.
 * NOTE: This should only be called once by the core code at startup.  Calling
 * this function after the server starts may cause unintended behavior across
 * the system.
 */
var loadConfiguration = function() {

    // If no log file exists, we should create one
	// TODO decide if this is still needed or if the file logger creates the file for us
    if (!fs.existsSync(LOG_FILE)) {
        if (!fs.existsSync(LOG_DIR)) {
            fs.mkdirSync(LOG_DIR);
        }
        console.log(&quot;SystemStartup: Creating log file [&quot;+LOG_FILE+&#x27;]&#x27;);
        fs.writeFileSync(LOG_FILE, &#x27;&#x27;);
    }

    var override       = {};
    var overrideFile   = null;
    var overridesFound = false;
    for (var i = 0; i &lt; OVERRIDE_FILE_PATHS.length; i++) {

    	overrideFile = OVERRIDE_FILE_PATHS[i];
    	if (fs.existsSync(overrideFile)) {

    		var result = fs.readFileSync(overrideFile, {encoding: &quot;UTF-8&quot;});
    	    if (typeof result === &#x27;Error&#x27;) {
    	        console.log(&#x27;SystemStartup: Failed to read external configuration file [&#x27;+overrideFile+&#x27;].&#x27;);
    	    }
    	    else{
    		    try{
    		      override       = JSON.parse(result);
    		      overridesFound = true;
    		      break;
    		    }
    		    catch(e){
    		      console.log(&#x27;SystemStartup: Failed to parse configuration file [&#x27;+overrideFile+&#x27;]: &#x27;+e.message);
    		    }
    	    }
    	}
    	else {
    		console.log(&#x27;SystemStartup: No configuration file [&#x27;+overrideFile+&#x27;] found.&#x27;);
    	}
    }

    //log result
    var message = overridesFound ? &#x27;Override file [&#x27;+overrideFile+&#x27;] will be applied.&#x27; : &#x27;No overrides are available, skipping to defaults&#x27;;
    console.log(&#x27;SystemStartup: &#x27;+message);

    //perform any overrides
    config = utils.deepMerge(override, config);

    //setup logging
    config.logging = {
		transports: [
             new (winston.transports.Console)({ level: config.log_level, timestamp: true, label: cluster.worker ? cluster.worker.id : &#x27;M&#x27;}),
             new (winston.transports.File)({ filename: LOG_FILE, level: config.log_level, timestamp: true })
       ]
	};
	return config;
};

//export configuration
config                   = loadConfiguration();
config.loadConfiguration = loadConfiguration;
module.exports           = config;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
